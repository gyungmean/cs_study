# 프로세스 & 스레드
## 프로세스
> 운영체제로부터 자원을 할당받은 작업의 단위

### 프로세스란?

- 실행중에 있는 프로그램
- 메모리에 올라와있고 실행되고 있는 프로그램의 인스턴스
- 스케줄링의 대상이 되는 작업(task)와 같은 의미로 쓰인다.
- 실제로는 스레드 단위로 스케줄링을 한다.
- 하드디스크에 있는 **프로그램을 실행** → 실행을 위한 **메모리 할당** → 할당된 메모리 공간으로 바이너리 코드가 올라감 → 이 순간부터 **프로세스**라고 불린다.

### 프로세스의 주소 공간

- Code 영역
    - 실행할 **프로그램의 코드**나 명령어들이 기계어 형태로 **저장**된 영역이다. CPU는 코드영역에 저장된 명령어들을 하나씩 처리한다.
- Data 영역
    - 코드에서 선언한 **전역 변수와 정적 변수가 저장**되는 영역이다. 프로그램이 실행되면서 할당되고 종료되면서 소멸한다.
- Stack 영역
    - **함수 안에서 선언된 지역변수, 매개변수**, 리터값등이 **저장**된다. 함수 호출시 기록되고 종료되면 제거된다.
- Heap 영역
    - 관리가 가능한 데이터 이외의 다른 형태의 데이터를 관리하기 위한 자유공간이다. 동적할당시 사용(new(), malloc())

🤔왜 이렇게 구역을 나눈건가요?  
최대한 데이터를 공유해서 메모리 사용량을 줄여야됨

### 프로세스의 상태

프로세스는 상태가 변경되며 수행된다. 

- Running
    - CPU 를 잡고 instruction 을 수행중인 상태
- Ready
    - CPU 를 기다리는 상태
- Blocked (waiting, sleep)
    - CPU를 주어도 당장 instruction 을 수행할 수 없는 상태
    - Process 자신이 요청한 event(예: I/O) 가 즉시 만족되지 않아, 이를 기다리는 상태
        - (예) 디스크에서 file 을 읽어와야 하는 경우
- New : 디스크에서 메모리로 프로그램이 올라가 실행준비를 하는 상태
- Terminated : 수행 (execution)이 끝난 상태

### 멀티 프로세스 ✨

- 하나의 응용 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 하나의 태스크를 처리하도록 하는 것
- 장점
    - 여러개의 프로세스 중 하나에 문제가 발생하면 혼자 죽는거 외에 더이상 피해가 퍼지지 않음 → **안전성**
- 단점
    - Context switching에서 **오버헤드** 발생 : 프로세스들 간에는 메모리를 공유하지 않기 때문에 캐쉬에 있는 모든 데이터가 매번 리셋되고 다시 불러오는 과정이 발생
    - 프로세스 사이의 어렵고 복잡한 통신

### 프로세스 자료구조 PCB(Process Control Block)

> 운영체제가 프로세스를 표현한 자료구조
- 특정 프로세스에 대한 정보를 가지고 있음
- 프로세스가 생성될 때마다 PCB생성 → 프로세스 완료시 삭제
- 프로세스간 문맥교환이 일어날 때 진행하던 작업들을 PCB에 저장 → 이후 자신의 순서가 왔을 때 이어서 처리  
[PCB에 대해 더 자세한 것은 다른 문서에서...](https://github.com/gyungmean/cs_study/blob/main/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/Context%20Switching.md)


### 문맥 교환(Context Swtich)

> 하나의 프로세스가 이미 CPU를 사용중인 상태에서 다른 프로세스가 CPU를 사용하기 위해 이전 프로세스 상태를 저장하고 새로운 프로세스의 상태를 적재하는 것.


예시 : 카톡을 켜놓고 유튜브로 노래를 들으면서 웹 서핑을 한다. → 동시에 일어나는 것 처럼 보이지만 아니다!

[문맥교환(Context Switching)은 다른 문서에서...](https://github.com/gyungmean/cs_study/blob/main/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/Context%20Switching.md)

## 스레드

> 프로세스 안에서 실행되는 여러 **흐름 단위**

### 스레드란?

- 프로세스가 하나 생성될 때, 기본적으로 하나의 스레드가 같이 생성된다.
- 프로세스는 자신만의 고유 공간과 자원을 할당받아 사용하지만! 스레드는 다른 스레드와 공간, 자원을 공유하면서 사용함
- 스레드는 stack 영역만 따로 할당받음
    - 왜?스레드는 독립적인 동작을 수행하기 위해 존재함 → 독립적으로 함수 호출 할 수 있어야됨 → 따라서 함수, 매개변수 등등을 저장하는 스택 메모리 영역을 독립적으로 받아야함
![image](https://github.com/gyungmean/cs_study/assets/70059000/43bfd08f-8566-44aa-863e-4cbaef8f5c79)

### 멀티 스레드 ✨

- 하나의 응용프로그램을 여러 개의 스레드로 구성하고 각 스레드로 하여금 하나의 작업을 처리하게 함
- 웹 서버는 대표적인 멀티 스레드 응용 프로그램이다.
- 장점
    - 시스템 자원 소모 감소
    - 시스템 처리량 증가
    - 간단한 통신 방법으로 응답시간 단축
- 단점
    - 주의 깊은 설계 필요
    - 디버깅 까다로움
    - 하나의 스레드가 데이터 공간을 망치면 모든 스레드가 망함

🤔멀티 프로세스 대신에 멀티 스레드를 사용하는 이유가 뭐죠?  
⇒ 프로그램을 여러개 키는 거보다 하나의 프로그램 안에서 여러 작업을 해결하는게 좋다!

- 자원의 효율성 증대 : 프로세스 생성으로 인한 자원 할당, 시스템 콜이 줄어들어 자원 효율적 관리 가능
- 처리 비용 감소 및 응답 시간 단축

근데 주의점!   
동기화 문제가 있음 스레드 간의 자원 공유는 전역변수를 이용하므로 함께 사용할 때 충돌 가능성이 있음

---
# :pencil: 퀴즈
> 프로세스와 스레드의 차이를 설명해보세요.